{% extends 'base.html' %}
{% load static %}

{% block title %}Param√®tres des Cookies{% endblock %}

{% block extra_css %}
<style>
.cookie-settings {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
}

.cookie-settings h1 {
    color: #333;
    margin-bottom: 2rem;
    text-align: center;
}

.cookie-category {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.cookie-category h3 {
    color: #007bff;
    margin-bottom: 1rem;
    font-size: 1.3rem;
}

.cookie-category p {
    color: #666;
    margin-bottom: 1rem;
    line-height: 1.6;
}

.cookie-category .form-check {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.cookie-category .form-check-input {
    margin: 0;
}

.cookie-category .form-check-label {
    margin: 0;
    font-weight: 500;
    cursor: pointer;
}

.cookie-category.required .form-check-input {
    opacity: 0.5;
    cursor: not-allowed;
}

.cookie-category.required .form-check-label {
    opacity: 0.7;
}

.cookie-settings-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
}

.cookie-settings-btn {
    padding: 0.75rem 2rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 500;
    transition: all 0.3s ease;
    min-width: 150px;
}

.cookie-settings-btn.save {
    background-color: #007bff;
    color: white;
}

.cookie-settings-btn.save:hover {
    background-color: #0056b3;
    transform: translateY(-2px);
}

.cookie-settings-btn.cancel {
    background-color: #6c757d;
    color: white;
}

.cookie-settings-btn.cancel:hover {
    background-color: #5a6268;
    transform: translateY(-2px);
}

.cookie-settings-btn.accept-all {
    background-color: #28a745;
    color: white;
}

.cookie-settings-btn.accept-all:hover {
    background-color: #218838;
    transform: translateY(-2px);
}

.cookie-settings-btn.decline-all {
    background-color: #dc3545;
    color: white;
}

.cookie-settings-btn.decline-all:hover {
    background-color: #c82333;
    transform: translateY(-2px);
}

.back-btn {
    display: inline-block;
    background-color: #007bff;
    color: white;
    padding: 0.75rem 1.5rem;
    text-decoration: none;
    border-radius: 5px;
    margin-bottom: 2rem;
    transition: background-color 0.3s ease;
}

.back-btn:hover {
    background-color: #0056b3;
    color: white;
    text-decoration: none;
}

@media (max-width: 768px) {
    .cookie-settings {
        padding: 1rem;
    }
    
    .cookie-settings-buttons {
        flex-direction: column;
    }
    
    .cookie-settings-btn {
        width: 100%;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="cookie-settings">
    <a href="{% url 'products:home_page' %}" class="back-btn">‚Üê Retour √† l'accueil</a>
    
    <h1>üç™ Param√®tres des Cookies</h1>
    <p class="text-center text-muted mb-4">
        G√©rez vos pr√©f√©rences de cookies pour personnaliser votre exp√©rience sur notre site.
    </p>
    
    <form id="cookieSettingsForm">
        <div class="cookie-category required">
            <h3>Cookies N√©cessaires</h3>
            <p>
                Ces cookies sont essentiels au fonctionnement du site et ne peuvent pas √™tre d√©sactiv√©s. 
                Ils incluent les cookies de session, de s√©curit√© et de pr√©f√©rences de base.
            </p>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="necessary" checked disabled>
                <label class="form-check-label" for="necessary">
                    Cookies n√©cessaires (obligatoires)
                </label>
            </div>
        </div>
        
        <div class="cookie-category">
            <h3>Cookies Analytiques</h3>
            <p>
                Ces cookies nous aident √† comprendre comment les visiteurs interagissent avec notre site 
                en collectant et rapportant des informations de mani√®re anonyme.
            </p>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="analytics">
                <label class="form-check-label" for="analytics">
                    Cookies analytiques
                </label>
            </div>
        </div>
        
        <div class="cookie-category">
            <h3>Cookies Marketing</h3>
            <p>
                Ces cookies sont utilis√©s pour afficher des publicit√©s pertinentes et mesurer 
                l'efficacit√© de nos campagnes publicitaires.
            </p>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="marketing">
                <label class="form-check-label" for="marketing">
                    Cookies marketing
                </label>
            </div>
        </div>
        
        <div class="cookie-category">
            <h3>Cookies de Pr√©f√©rences</h3>
            <p>
                Ces cookies m√©morisent vos pr√©f√©rences et param√®tres pour am√©liorer votre exp√©rience 
                de navigation (langue, r√©gion, etc.).
            </p>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="preferences">
                <label class="form-check-label" for="preferences">
                    Cookies de pr√©f√©rences
                </label>
            </div>
        </div>
        
        <div class="cookie-category">
            <h3>Cookies R√©seaux Sociaux</h3>
            <p>
                Ces cookies permettent l'int√©gration des r√©seaux sociaux et le partage de contenu 
                sur les plateformes sociales.
            </p>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="social">
                <label class="form-check-label" for="social">
                    Cookies r√©seaux sociaux
                </label>
            </div>
        </div>
        
        <div class="cookie-settings-buttons">
            <button type="button" class="cookie-settings-btn accept-all" onclick="acceptAllCookies()">
                Accepter tout
            </button>
            <button type="button" class="cookie-settings-btn decline-all" onclick="declineAllCookies()">
                Refuser tout
            </button>
            <button type="button" class="cookie-settings-btn save" onclick="saveCookieSettings()">
                Sauvegarder
            </button>
            <button type="button" class="cookie-settings-btn cancel" onclick="goBack()">
                Annuler
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Charger les param√®tres existants
    loadExistingSettings();
});

function loadExistingSettings() {
    fetch('{% url "popups:get_cookie_consent" %}')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success' && data.consent) {
                // Appliquer les param√®tres existants
                document.getElementById('analytics').checked = data.consent.analytics;
                document.getElementById('marketing').checked = data.consent.marketing;
                document.getElementById('preferences').checked = data.consent.preferences;
                document.getElementById('social').checked = data.consent.social;
            }
        })
        .catch(error => {
            console.error('Erreur lors du chargement des param√®tres:', error);
        });
}

function acceptAllCookies() {
    // Cocher toutes les cases
    document.getElementById('analytics').checked = true;
    document.getElementById('marketing').checked = true;
    document.getElementById('preferences').checked = true;
    document.getElementById('social').checked = true;
    
    // Sauvegarder
    saveCookieSettings();
}

function declineAllCookies() {
    // D√©cocher toutes les cases (sauf n√©cessaires)
    document.getElementById('analytics').checked = false;
    document.getElementById('marketing').checked = false;
    document.getElementById('preferences').checked = false;
    document.getElementById('social').checked = false;
    
    // Sauvegarder
    saveCookieSettings();
}

function saveCookieSettings() {
    const form = document.getElementById('cookieSettingsForm');
    const formData = new FormData(form);
    
    const consent = {
        necessary: true, // Toujours true
        analytics: formData.get('analytics') === 'on',
        marketing: formData.get('marketing') === 'on',
        preferences: formData.get('preferences') === 'on',
        social: formData.get('social') === 'on'
    };
    
    fetch('{% url "popups:save_cookie_consent" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify(consent)
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            // Afficher un message de succ√®s
            alert('Vos pr√©f√©rences de cookies ont √©t√© sauvegard√©es avec succ√®s !');
            // Rediriger vers la page d'accueil
            window.location.href = '{% url "products:home_page" %}';
        } else {
            alert('Erreur lors de la sauvegarde des param√®tres.');
        }
    })
    .catch(error => {
        console.error('Erreur lors de la sauvegarde:', error);
        alert('Une erreur est survenue. Veuillez r√©essayer.');
    });
}

function goBack() {
    window.history.back();
}
</script>
{% endblock %}
