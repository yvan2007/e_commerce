{% extends 'base/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}Mes Adresses de Livraison - KefyStore{% endblock %}

{% block extra_css %}
<style>
    .address-card {
        border: 2px solid #e9ecef;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
        background: white;
    }
    
    .address-card:hover {
        border-color: #667eea;
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.15);
        transform: translateY(-5px);
    }
    
    .address-card.default {
        border-color: #667eea;
        background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%);
    }
    
    .address-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 700;
    }
    
    .address-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #e9ecef;
    }
    
    .btn-action {
        flex: 1;
        padding: 0.5rem;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-edit {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }
    
    .btn-edit:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-delete {
        background: #dc3545;
        color: white;
    }
    
    .btn-delete:hover {
        background: #c82333;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
    }
    
    .btn-set-default {
        background: #28a745;
        color: white;
    }
    
    .btn-set-default:hover {
        background: #218838;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- En-tête -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="fw-bold">
                <i class="fas fa-map-marker-alt text-primary me-2"></i>
                Mes Adresses de Livraison
            </h2>
            <p class="text-muted">Gérez vos adresses de livraison pour des achats plus rapides</p>
        </div>
    </div>
    
    <!-- Liste des adresses -->
    <div class="row">
        <div class="col-md-4 mb-3">
            <a href="{% url 'orders:shipping_address_create' %}" class="btn btn-primary btn-lg w-100" style="height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 2px dashed #667eea;">
                <i class="fas fa-plus fa-2x mb-3"></i>
                <span>Nouvelle Adresse</span>
            </a>
        </div>
        
        {% if addresses %}
        {% for address in addresses %}
            <div class="col-md-6">
                <div class="address-card position-relative {% if address.is_default %}default{% endif %}">
                    {% if address.is_default %}
                        <span class="address-badge">
                            <i class="fas fa-star me-1"></i>
                            Par défaut
                        </span>
                    {% endif %}
                    
                    <div class="mb-3">
                        <h5 class="fw-bold mb-1">
                            <i class="fas fa-user me-2 text-primary"></i>
                            {{ address.first_name }} {{ address.last_name }}
                        </h5>
                        <p class="text-muted mb-0">
                            <i class="fas fa-phone me-2"></i>{{ address.phone }}
                        </p>
                    </div>
                    
                    <div class="address-info mb-3">
                        <p class="mb-2">
                            <i class="fas fa-map-marker-alt text-danger me-2"></i>
                            {{ address.address }}
                        </p>
                        <p class="mb-0 text-muted">
                            <i class="fas fa-city me-2"></i>
                            {% if address.postal_code %}{{ address.postal_code }} - {% endif %}
                            {{ address.city }}, {{ address.country }}
                        </p>
                    </div>
                    
                    <div class="address-actions">
                        {% if not address.is_default %}
                        <form method="post" action="{% url 'orders:shipping_address_update' address.pk %}" class="w-100">
                            {% csrf_token %}
                            <input type="hidden" name="is_default" value="true">
                            <button type="submit" class="btn btn-set-default btn-action">
                                <i class="fas fa-star me-1"></i>
                                Définir par défaut
                            </button>
                        </form>
                        {% endif %}
                        
                        <a href="{% url 'orders:shipping_address_update' address.pk %}" class="btn btn-edit btn-action">
                            <i class="fas fa-edit me-1"></i>
                            Modifier
                        </a>
                        
                        <form method="post" action="{% url 'orders:shipping_address_delete' address.pk %}" class="{% if not address.is_default %}w-100{% endif %}" 
                              onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette adresse ?');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-delete btn-action" {% if address.is_default %}style="display: none;"{% endif %}>
                                <i class="fas fa-trash me-1"></i>
                                Supprimer
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        {% endif %}
    </div>
    
    <!-- Actions -->
    <div class="row mt-4">
        <div class="col-12 text-center">
            <a href="{% url 'orders:order_list' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>
                Retour aux Commandes
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Confirmation de suppression
document.querySelectorAll('.address-card').forEach(card => {
    const deleteForm = card.querySelector('form[action*="delete"]');
    if (deleteForm) {
        deleteForm.addEventListener('submit', function(e) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer cette adresse ?')) {
                e.preventDefault();
            }
        });
    }
});
</script>
{% endblock %}
